# Spec: generation-history

## ADDED Requirements

### Requirement: 系统 SHALL 支持用户查看所有生成历史

系统 SHALL 支持已登录用户查看自己所有的图片生成记录。

#### Scenario: 加载生成历史列表

**Given** 用户已登录
**And** 用户历史生成了 25 张图片
**When** 用户访问生成器页面
**Then** 页面底部显示"生成历史"区域
**And** 自动加载最新的 20 条生成记录
**And** 每条记录显示: 结果图片缩略图、风格名称、创建时间
**And** 记录按创建时间降序排列

#### Scenario: 无限滚动加载更多历史

**Given** 用户已加载 20 条历史记录
**And** 用户总共有 50 条历史记录
**When** 用户滚动到历史列表底部
**Then** 系统自动加载下一批 20 条记录
**And** 加载时显示 loading 提示
**And** 新记录追加到列表末尾
**And** 加载完所有记录后显示"没有更多了"提示

#### Scenario: 用户没有生成历史

**Given** 用户是新注册用户
**And** 用户从未生成过图片
**When** 用户访问生成器页面
**Then** 历史区域显示空状态提示
**And** 提示文案为"还没有生成记录,开始创作吧!"
**And** 显示一个指向上传区域的提示图标

---

### Requirement: 历史记录卡片 SHALL 显示关键信息

每条历史记录 SHALL 以卡片形式展示,包含必要的信息和操作。

#### Scenario: 历史卡片信息展示

**Given** 用户查看生成历史
**When** 系统渲染历史记录卡片
**Then** 卡片显示生成结果的缩略图(200x200px, 桌面端)
**And** 卡片左上角显示风格标签(如"油画风格")
**And** 卡片底部显示相对创建时间(如"2小时前")
**And** 卡片使用 Card 组件,带轻微阴影

#### Scenario: 历史卡片 hover 交互

**Given** 用户查看生成历史卡片
**When** 用户鼠标悬停在卡片上
**Then** 卡片阴影加深
**And** 显示操作按钮覆盖层
**And** 操作按钮包括: "查看大图"、"下载"、"重新生成"

#### Scenario: 查看历史图片大图

**Given** 用户hover在历史卡片上
**When** 用户点击"查看大图"按钮
**Then** 打开 Dialog 展示完整尺寸的生成结果
**And** Dialog 显示图片元数据: 风格、创建时间、使用积分
**And** Dialog 提供下载和关闭按钮

---

### Requirement: 历史记录 SHALL 支持快速操作

历史记录 SHALL 支持快速操作,用户可以直接从历史记录进行常用操作,无需重新上传图片。

#### Scenario: 从历史重新生成

**Given** 用户查看某条历史记录
**And** 该记录的源图片仍然存在
**When** 用户点击"重新生成"按钮
**Then** 系统自动填充源图片到上传区域
**And** 系统自动选择相同的风格
**And** 页面滚动到顶部生成按钮
**And** 用户可以直接点击"生成头像"按钮

#### Scenario: 下载历史图片

**Given** 用户查看历史记录
**When** 用户点击"下载"按钮
**Then** 系统下载对应的生成结果图片
**And** 文件名格式为 "petsphoto_{timestamp}.jpg"

---

### Requirement: 历史记录数据 MUST 正确关联用户

系统 MUST 确保每个用户只能看到自己的生成历史。

#### Scenario: 用户隔离验证

**Given** 用户 A 登录系统
**And** 用户 A 有 10 条生成记录
**And** 用户 B 有 20 条生成记录
**When** 用户 A 访问生成器页面
**Then** 系统只返回用户 A 的 10 条记录
**And** 不显示用户 B 的任何记录

#### Scenario: 未登录用户无法访问历史

**Given** 用户未登录
**When** 用户访问生成器页面
**Then** 不显示历史记录区域
**Or** 显示提示"登录后查看历史记录"
